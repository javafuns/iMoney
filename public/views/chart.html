<!doctype html>
<html>
  <head>
    <title>iMoney - Monthly Analytics</title>
    <script src="js/Chart.bundle.js"></script>
    <script src="js/utils.js"></script>
    <style>
      canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }

       * {
            padding: 0;
            margin: 0;
            line-height: 25px;
            font-size: 12px;
            list-style:none
        }
        #tabContainer
        {
            margin-top: 30px;
            margin-left: 50px;
            margin-right: 50px;
        }
        #tabContainer li
        {
            float: left;
            width: 80px;
            margin: 0 3px;
            background: #efefef;
            text-align: center;
        }
        #tabContainer a
        {
            display: block;
            text-decoration: none;
        }
        #tabContainer a.on
        {
            background: pink;
            text-decoration: none;
        }
    </style>
    <script type="text/javascript">
        function switchTab(tabIdx, divIdx) {
            for (i = 1; i < 4; i++) {
                if ("tab" + i == tabIdx) {
                    document.getElementById(tabIdx).getElementsByTagName("a")[0].className = "on";
                } else {
                    document.getElementById("tab" + i).getElementsByTagName("a")[0].className = "";
                }
                if ("div" + i == divIdx) {
                    document.getElementById(divIdx).style.display = "";
                } else {
                    document.getElementById("div" + i).style.display = "none";
                }
            }
        }
    </script>
</head>
    
<body>
  <div style="margin-top: 30px; margin-left: 50px; margin-right: 50px; font-size: 15px;">Be patient, loading data and paint ......</div>
  <div id="tabContainer">
    <ul>
      <li id="tab1"><a href="" class="on" onclick="switchTab('tab1','div1');this.blur();clickTab('1', 'bar');return false;">Bar</a></li>
      <li id="tab2"><a href="" onclick="switchTab('tab2','div2');this.blur();clickTab('2', 'line');return false;">Line</a></li>
      <li id="tab3"><a href="" onclick="switchTab('tab3','div3');this.blur();clickTab('3', 'pie');return false;">Pie</a></li>
    </ul>
    <div style="clear: both"> </div>
    <div id="div1">
      <canvas id="myChart1" width="400" height="400"></canvas>
    </div>
    <div id="div2" style="display: none">
      <canvas id="myChart2" width="400" height="400"></canvas>
    </div>
    <div id="div3" style="display: none">
      <canvas id="myChart3" width="400" height="400"></canvas>
    </div>
  </div>

<script>
window.onload = clickTab('1', "bar");

function clickTab(index, ct) {
  var url = window.location.href;
  var domainName = url.split("/");
  var newURL = "/api/listCostPerMonth";
  var xmlHttp = new XMLHttpRequest();

  xmlHttp.onreadystatechange = function() { 
    if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
      chartNow(index, ct, xmlHttp.responseText);
  }
  xmlHttp.open("GET", newURL, true); // true for asynchronous 
  xmlHttp.send(null);
}

function chartNow(index, ct, rawData) {
	var ctx = document.getElementById("myChart" + index);
  var chartData = getChartData(ct, rawData);
	var myChart = new Chart(ctx, {
	    type: ct,
	    data: chartData,
	    options: {
		scales: {
		    yAxes: [{
			ticks: {
			    beginAtZero:true
			}
		    }]
		}
	    }
	});
};

function getChartData(chartType, rawData) {
  var rawDataArray = rawData.split(",");
  for(var i=0; i<rawDataArray.length; i++) { rawDataArray[i] = parseInt(rawDataArray[i], 10); }
  if ("bar" == chartType)
    return {
      labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
      datasets: [{
        label: 'Cost per Month',
        data: rawDataArray,
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        borderWidth: 1
      }]
    };
  else if ("line" == chartType)
    return {
      labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
      datasets: [
      {
        label: "Cost per Month",
        fill: false,
        lineTension: 0.1,
        backgroundColor: "rgba(75,192,192,0.4)",
        borderColor: "rgba(75,192,192,1)",
        borderCapStyle: 'butt',
        borderDash: [],
        borderDashOffset: 0.0,
        borderJoinStyle: 'miter',
        pointBorderColor: "rgba(75,192,192,1)",
        pointBackgroundColor: "#fff",
        pointBorderWidth: 1,
        pointHoverRadius: 5,
        pointHoverBackgroundColor: "rgba(75,192,192,1)",
        pointHoverBorderColor: "rgba(220,220,220,1)",
        pointHoverBorderWidth: 2,
        pointRadius: 1,
        pointHitRadius: 10,
        data: rawDataArray,
        spanGaps: false,
      }
      ]
    };
  else if ("pie" == chartType)
    return {
      labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
      datasets: [{
        data: rawDataArray,
        backgroundColor: [
        "#FF6384",
        "#36A2EB",
        "#006384",
        "#FF2304",
        "#03F0FF",
        "#0F22EB",
        "#AAA2EB",
        "#39AA0B",
        "#F06004",
        "#99A20F",
        "#FFAFFB",
        "#FFCE56"
        ],
        hoverBackgroundColor: [
        "#FF6384",
        "#36A2EB",
        "#FF6384",
        "#FF2304",
        "#F36384",
        "#3EA2EB",
        "#AAA2EB",
        "#39A2EB",
        "#F06384",
        "#E0A2EB",
        "#3FA2EB",
        "#FFCE56"
        ]
      }]
    };
  else alert("Undefined Chart Type");
};

</script>
  </body>
</html>
